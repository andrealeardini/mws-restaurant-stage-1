{"version":3,"sources":["idb.js","restaurant_info.js","dbHelper.js"],"names":["promisifyRequest","request","Promise","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","p","apply","then","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","prototype","get","this","set","val","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","value","Cursor","Index","index","_index","cursor","_cursor","_request","ObjectStore","store","_store","Transaction","idbTransaction","_tx","complete","oncomplete","onabort","UpgradeDB","db","oldVersion","transaction","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","objectStore","IDBTransaction","createObjectStore","IDBDatabase","funcName","replace","arr","Array","slice","call","callback","length","nativeObject","getAll","query","count","instance","items","iterateCursor","push","undefined","continue","exp","open","name","version","upgradeCallback","indexedDB","onupgradeneeded","event","delete","module","exports","default","self","idb","restaurant","reviews","map","DBHelper","_dbPromise","_dbOpened","openDB","dbPromise","getRestaurantsFromDB","restaurants","fetchRestaurantsFromNetwork","catch","saveToDB","xhr","XMLHttpRequest","DATABASE_URL","onload","status","JSON","parse","responseText","saveRestaurantsToDB","send","id","fetchRestaurants","find","r","cuisine","results","filter","cuisine_type","neighborhood","neighborhoods","v","i","uniqueNeighborhoods","indexOf","cuisines","uniqueCuisines","google","maps","Marker","position","latlng","title","url","urlForRestaurant","animation","Animation","DROP","dbOpened","window","upgradeDb","keyPath","autoIncrement","tx","clear","data","put","navigator","onLine","deleteRestaurantsFromDB","restaurantsStore","review","favorite","fetch","addFavoriteToOfflineDB","getFavoritesOffline","favorites","updateFavorite","toast","deleteFavoriteFromOffline","getReviewsOffline","FD","FormData","append","restaurant_id","rating","comments","DATABASE_REVIEWS_URL","body","deleteReviewFromOffline","fetchReviewsFromNetwork","location","href","includes","fillReviewsHTML","sendOfflineFavoritesToServer","sendOfflineReviewsToServer","setTimeout","syncFavorites","syncReviews","is_favorite","document","getElementById","classList","add","remove","getReviewsFromDB","fetchReviews","response","json","saveReviewsToDB","deleteReviewsFromDB","reviewsStore","parseInt","Number","fetchRestaurantFromURL","syncro","getParameterByName","fetchRestaurantById","fillRestaurantHTML","addEventListener","serviceWorker","register","registration","err","initMap","Map","zoom","center","gestureHandling","mapMarkerForRestaurant","hidden","innerHTML","favorite_fab","firstElementChild","innerText","onFavoriteClick","onCreateReview","address","picture","picture_source","createElement","setAttribute","imageUrlForRestaurant","image","alt","imageDescriptionForRestaurant","src","operating_hours","fillRestaurantHoursHTML","review_thisRestaurant","reverse","operatingHours","hours","key","row","day","className","appendChild","time","add_offline","refresh","container","noReviews","ul","insertBefore","createReviewHTML","firstChild","focus","li","header","date","reviewDate","Date","updatedAt","toLocaleDateString","offline_icon","fillBreadcrumb","breadcrumb","a","RegExp","exec","decodeURIComponent","showMap","scrMaps","dataset","gm_authFailure","e","favoriteHTML","target","nodeName","parentElement","contains","toggle","msg","millisenconds","priority","toastHTML","timer","clearTimeout","form","type","placeholder","required","scores","score","style","height","scrollHeight","save","span","delete_btn","span_delete","add_fab","getElementsByClassName","closeReview","preventDefault","delConfirm","cancelButton","confirmButton","showModal","close","XHR","addReviewToOfflineDB","sendData","googleMapsError","syncAll"],"mappings":"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","file":"restaurant_all.js","sourcesContent":["'use strict';\n\n(function () {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function (resolve, reject) {\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n\n      request.onerror = function () {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function (resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function (value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function (prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function () {\n          return this[targetProp][prop];\n        },\n        set: function (val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function () {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function () {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function () {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function (methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function () {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function () {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function (value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function () {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function () {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function (resolve, reject) {\n      idbTransaction.oncomplete = function () {\n        resolve();\n      };\n      idbTransaction.onerror = function () {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function () {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function () {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function () {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function () {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function (funcName) {\n    [ObjectStore, Index].forEach(function (Constructor) {\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function () {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function () {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function (Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function (query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function (resolve) {\n        instance.iterateCursor(query, function (cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function (name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      request.onupgradeneeded = function (event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n\n      return p.then(function (db) {\n        return new DB(db);\n      });\n    },\n    delete: function (name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  } else {\n    self.idb = exp;\n  }\n}());","var restaurant;\r\nvar reviews;\r\nvar map;\r\n\r\n\r\n/**\r\n * checks to see if the service worker API is available, and if it is, the service worker at /sw.js is registered\r\n */\r\nif ('serviceWorker' in navigator) {\r\n  window.addEventListener('load', function () {\r\n    navigator.serviceWorker.register('/sw.js').then(function (registration) {\r\n      // Registration was successful\r\n      void 0;\r\n    }, function (err) {\r\n      // registration failed :(\r\n      void 0;\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Initialize Google map, called from HTML.\r\n */\r\nwindow.initMap = () => {\r\n  fetchRestaurantFromURL((error, restaurant) => {\r\n    if (error) { // Got an error!\r\n      void 0;\r\n    } else {\r\n      self.map = new google.maps.Map(document.getElementById('map'), {\r\n        zoom: 16,\r\n        center: restaurant.latlng,\r\n        gestureHandling: 'cooperative'\r\n      });\r\n      DBHelper.mapMarkerForRestaurant(self.restaurant, self.map);\r\n      document.getElementById('map').classList.remove('inactive');\r\n      document.getElementById('image-blurred').hidden = true;\r\n      document.getElementById('image-blurred-text').hidden = true;\r\n    }\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Get current restaurant from page URL.\r\n */\r\nfunction fetchRestaurantFromURL(callback, syncro = false) {\r\n  if ((self.restaurant) && (syncro == false)) { // restaurant already fetched!\r\n    callback(null, self.restaurant);\r\n    return;\r\n  }\r\n  const id = getParameterByName('id');\r\n  if (!id) { // no id found in URL\r\n    const error = 'No restaurant id in URL';\r\n    callback(error, null);\r\n  } else {\r\n    DBHelper.fetchReviews(id, (error, reviews) => {\r\n      self.reviews = reviews;\r\n      DBHelper.fetchRestaurantById(id, (error, restaurant) => {\r\n        self.restaurant = restaurant;\r\n        if (!restaurant) {\r\n          void 0;\r\n          return;\r\n        }\r\n        fillRestaurantHTML();\r\n        callback(null, restaurant);\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Create restaurant HTML and add it to the webpage\r\n */\r\nconst fillRestaurantHTML = (restaurant = self.restaurant) => {\r\n  DBHelper.getFavoritesOffline().then(favorites => {\r\n    const name = document.getElementById('restaurant-name');\r\n    name.innerHTML = restaurant.name;\r\n\r\n    const favorite_fab = document.getElementById('favorite-fab');\r\n    favorite_fab.value = restaurant.id;\r\n    if (favorites.length) {\r\n      const results = favorites.filter(r => r.id == restaurant.id);\r\n      if (results.length) {\r\n        restaurant.is_favorite = results[0].value;\r\n      }\r\n    }\r\n\r\n    if (restaurant.is_favorite) {\r\n      if ((restaurant.is_favorite == true) || (restaurant.is_favorite == 'true')) {\r\n        favorite_fab.classList.add('app-fab--isfavorite');\r\n        favorite_fab.firstElementChild.innerText = 'favorite';\r\n      }\r\n    }\r\n\r\n    favorite_fab.addEventListener('click', onFavoriteClick);\r\n\r\n    const add_fab = document.getElementById('add-fab');\r\n    add_fab.addEventListener('click', onCreateReview);\r\n\r\n    const address = document.getElementById('restaurant-address');\r\n    address.innerHTML = restaurant.address;\r\n\r\n    const picture = document.getElementById('restaurant-picture');\r\n    const picture_source = document.createElement('source');\r\n    picture_source.setAttribute('type', 'image/webp');\r\n    picture_source.setAttribute('srcset', `${DBHelper.imageUrlForRestaurant(restaurant)}.webp`);\r\n    picture.append(picture_source);\r\n    const image = document.createElement('img');\r\n    image.id = 'restaurant-img';\r\n    image.alt = DBHelper.imageDescriptionForRestaurant(restaurant);\r\n    image.src = `${DBHelper.imageUrlForRestaurant(restaurant)}.jpg`;\r\n    picture.append(image);\r\n\r\n    const cuisine = document.getElementById('restaurant-cuisine');\r\n    cuisine.innerHTML = restaurant.cuisine_type;\r\n\r\n    // fill operating hours\r\n    if (restaurant.operating_hours) {\r\n      fillRestaurantHoursHTML();\r\n    }\r\n    // fill reviews\r\n    fillReviewsHTML();\r\n\r\n    // add reviews offline\r\n    DBHelper.getReviewsOffline().then(reviews => {\r\n      const review_thisRestaurant = reviews.filter(r => r.restaurant_id == restaurant.id);\r\n      review_thisRestaurant.reverse();\r\n      fillReviewsHTML(review_thisRestaurant, true, true);\r\n    })\r\n  }).catch((error) => {\r\n    void 0;\r\n  });\r\n};\r\n\r\n/**\r\n * Create restaurant operating hours HTML table and add it to the webpage.\r\n */\r\nconst fillRestaurantHoursHTML = (operatingHours = self.restaurant.operating_hours) => {\r\n  const hours = document.getElementById('restaurant-hours');\r\n  for (let key in operatingHours) {\r\n    const row = document.createElement('tr');\r\n\r\n    const day = document.createElement('td');\r\n    day.innerHTML = key;\r\n    day.className = 'restaurant-day';\r\n    row.appendChild(day);\r\n\r\n    const time = document.createElement('td');\r\n    time.innerHTML = operatingHours[key];\r\n    row.appendChild(time);\r\n\r\n    hours.appendChild(row);\r\n  }\r\n};\r\n\r\n/**\r\n * Create all reviews HTML and add them to the webpage.\r\n * @reviews the reviews to fill in the container\r\n * @add_offline true to add the reviews from offline db without clear the container\r\n * @refresh true if the container is already filled, refresh only the reviews\r\n */\r\nfunction fillReviewsHTML(reviews = self.reviews, add_offline = false, refresh = false) {\r\n  const container = document.getElementById('reviews-container');\r\n  if (refresh == false) {\r\n    const title = document.createElement('h2');\r\n    title.innerHTML = 'Reviews';\r\n    container.appendChild(title);\r\n  }\r\n\r\n  if (!reviews) {\r\n    const noReviews = document.createElement('p');\r\n    noReviews.id = 'no-reviews';\r\n    if (navigator.onLine == true) {\r\n      noReviews.innerHTML = 'No reviews yet!';\r\n    } else {\r\n      noReviews.innerHTML = 'You are offline and it seems that is the first time that you visit this restaurants. All reviews will be cached when you visit the page online';\r\n    }\r\n    container.appendChild(noReviews);\r\n    return;\r\n  }\r\n\r\n  const ul = document.getElementById('reviews-list');\r\n  if (add_offline == false) {\r\n    ul.innerHTML = '';\r\n  }\r\n\r\n  // sort reviews by date (from last to first)\r\n  reviews.reverse()\r\n  reviews.forEach(review => {\r\n    if (add_offline == true) {\r\n      ul.insertBefore(createReviewHTML(review, add_offline), ul.firstChild);\r\n      ul.firstChild.focus();\r\n    } else {\r\n      ul.appendChild(createReviewHTML(review, add_offline));\r\n    }\r\n  });\r\n  container.appendChild(ul);\r\n}\r\n\r\n/**\r\n * Create review HTML and add it to the webpage.\r\n */\r\nconst createReviewHTML = (review, add_offline) => {\r\n  const li = document.createElement('li');\r\n\r\n  const header = document.createElement('div');\r\n  header.className = 'reviews-header';\r\n  const name = document.createElement('p');\r\n  name.innerHTML = review.name;\r\n  name.className = 'reviews-name';\r\n  header.appendChild(name);\r\n\r\n  if (add_offline == false) {\r\n    const date = document.createElement('p');\r\n    let reviewDate = new Date(review.updatedAt).toLocaleDateString();\r\n    date.innerHTML = reviewDate;\r\n    date.className = 'reviews-date';\r\n    header.appendChild(date);\r\n  } else {\r\n    const offline_icon = document.createElement('i');\r\n    offline_icon.innerText = 'offline_bolt';\r\n    offline_icon.classList.add('material-icons');\r\n    offline_icon.classList.add('review-offline');\r\n    header.appendChild(offline_icon);\r\n  }\r\n\r\n  li.appendChild(header);\r\n\r\n  const rating = document.createElement('p');\r\n  rating.innerHTML = `Rating: ${review.rating}`;\r\n  rating.className = 'reviews-rating';\r\n  li.appendChild(rating);\r\n\r\n  const comments = document.createElement('p');\r\n  comments.innerHTML = review.comments;\r\n  li.appendChild(comments);\r\n\r\n  return li;\r\n};\r\n\r\n/**\r\n * Add restaurant name to the breadcrumb navigation menu\r\n */\r\nconst fillBreadcrumb = (restaurant = self.restaurant) => {\r\n  const breadcrumb = document.getElementById('breadcrumb');\r\n  const li = document.createElement('li');\r\n  const a = document.createElement('a');\r\n  a.href = DBHelper.urlForRestaurant(restaurant);\r\n  a.innerHTML = restaurant.name;\r\n  a.setAttribute('aria-current', 'page');\r\n  li.appendChild(a);\r\n  breadcrumb.appendChild(li);\r\n};\r\n\r\n/**\r\n * Get a parameter by name from page URL.\r\n */\r\nconst getParameterByName = (name, url) => {\r\n  if (!url)\r\n    url = window.location.href;\r\n  name = name.replace(/[\\[\\]]/g, '\\\\$&');\r\n  const regex = new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),\r\n    results = regex.exec(url);\r\n  if (!results)\r\n    return null;\r\n  if (!results[2])\r\n    return '';\r\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\r\n};\r\n\r\nfunction showMap() {\r\n  const scrMaps = document.getElementById('GoogleMaps');\r\n  scrMaps.src = scrMaps.dataset.src;\r\n}\r\n\r\nwindow.googleMapsError = () => {\r\n  void 0;\r\n};\r\n\r\nfunction gm_authFailure() {\r\n  void 0;\r\n}\r\n\r\nwindow.addEventListener('load', (event) => {\r\n  DBHelper.syncAll();\r\n  fetchRestaurantFromURL((error, restaurant) => {\r\n    if (error) { // Got an error!\r\n      void 0;\r\n    } else {\r\n      fillBreadcrumb();\r\n      document.getElementById('map-container').addEventListener('click', showMap);\r\n    }\r\n  });\r\n});\r\n\r\nfunction onFavoriteClick(e) {\r\n  let favoriteHTML;\r\n  if (e.target.nodeName == 'SPAN') {\r\n    favoriteHTML = e.target.parentElement;\r\n  } else {\r\n    favoriteHTML = e.target;\r\n  }\r\n  void 0;\r\n  let favorite = {\r\n    id: favoriteHTML.value,\r\n    value: 'false'\r\n  };\r\n  if (!(favoriteHTML.classList.contains('app-fab--isfavorite'))) {\r\n    favorite.value = 'true';\r\n  }\r\n\r\n  DBHelper.updateFavorite(favorite).then(() => {\r\n    void 0;\r\n  });\r\n\r\n  if (favorite.value == 'true') {\r\n    favoriteHTML.setAttribute('aria-label', 'The restaurant is marked as favorite');\r\n    favoriteHTML.firstElementChild.innerText = 'favorite'\r\n  } else {\r\n    favoriteHTML.setAttribute('aria-label', 'Click to mark the restaurant as favorite');\r\n    favoriteHTML.firstElementChild.innerText = 'favorite_border'\r\n  }\r\n  favoriteHTML.classList.toggle('app-fab--isfavorite');\r\n}\r\n\r\n\r\nwindow.addEventListener('online', (event) => {\r\n  // console.log(\"You are online\")\r\n  let offline = document.getElementById('offline');\r\n  offline.classList.remove('show');\r\n  toast('You are online.' + '\\n' +\r\n    'All changes will be synchronized.', 5000, true);\r\n  // reload the restaurant and update the reviews\r\n  DBHelper.syncAll();\r\n});\r\n\r\nwindow.addEventListener('offline', (event) => {\r\n  // console.log(\"You are offline\")\r\n  let offline = document.getElementById('offline');\r\n  offline.classList.add('show');\r\n  toast('You are offline.' + '\\n' +\r\n    'All changes will be synchronized when you return online.', 5000, true);\r\n});\r\n\r\n/**\r\n * Show a toast\r\n * @msg the message to show\r\n * @milliseconds the durate of the toast in millisenconds\r\n * @priority set to true to override the previous toast if is still displayed\r\n * \r\n * by Andrea Leardini\r\n */\r\nfunction toast(msg, millisenconds, priority = false) {\r\n  let toastHTML = document.getElementById('toast');\r\n  let timer;\r\n  if (toastHTML.classList.contains('show') == true) {\r\n    // avoid to display the same messagere multiple times\r\n    if (msg == toastHTML.innerText) {\r\n      return;\r\n    }\r\n    if (priority == false) {\r\n      setTimeout(() => {\r\n        // wait until the previeous message is hide\r\n        clearTimeout(timer);\r\n        toast(msg, millisenconds, priority);\r\n      }, 2000);\r\n      return;\r\n    }\r\n  }\r\n  toastHTML.innerText = msg;\r\n  toastHTML.classList.add('show');\r\n  // After x milliseconds hide the toast\r\n  timer = setTimeout(() => {\r\n    toastHTML.classList.remove('show');\r\n  }, millisenconds);\r\n}\r\n\r\nwindow.addEventListener('DOMContentLoaded', (event) => {\r\n  if ((!navigator.onLine)) {\r\n    let offline = document.getElementById('offline');\r\n    offline.classList.add('show');\r\n  }\r\n});\r\n\r\n/**\r\n * Create a new review.\r\n */\r\nfunction onCreateReview() {\r\n  const ul = document.getElementById('reviews-list');\r\n  const li = document.createElement('li');\r\n  li.classList.add('addReview');\r\n\r\n  const form = document.createElement('form');\r\n\r\n  const header = document.createElement('div');\r\n  header.className = 'reviews-header';\r\n  const title = document.createElement('h3');\r\n  title.innerText = 'New review';\r\n  header.appendChild(title);\r\n\r\n  form.appendChild(header);\r\n\r\n  const id = document.createElement('input');\r\n  id.value = getParameterByName('id');\r\n  id.name = 'restaurant_id';\r\n  id.type = 'hidden';\r\n  form.appendChild(id);\r\n\r\n  const name = document.createElement('input');\r\n  name.className = 'reviews-name';\r\n  name.placeholder = 'Insert your name';\r\n  name.required = true;\r\n  name.name = 'name';\r\n  form.appendChild(name);\r\n\r\n  const rating = document.createElement('p');\r\n  rating.className = 'reviews-rating';\r\n  rating.innerText = 'Rating: ';\r\n  const scores = document.createElement('select');\r\n  scores.classList.add('reviews-rating-score');\r\n  for (let i = 1; i <= 5; i++) {\r\n    let score = document.createElement('option');\r\n    score.id = `score${i}`;\r\n    score.value = i;\r\n    score.innerText = i;\r\n    scores.appendChild(score);\r\n    scores.name = 'rating';\r\n  }\r\n  rating.appendChild(scores);\r\n\r\n  form.appendChild(rating);\r\n\r\n  const comments = document.createElement('textarea');\r\n  comments.placeholder = 'Type your review here...';\r\n  comments.className = 'reviews-comments';\r\n  comments.required = true;\r\n  comments.name = 'comments';\r\n\r\n  comments.addEventListener('input', (event) => {\r\n    comments.style.height = 'auto';\r\n    comments.style.height = `${comments.scrollHeight}px`;\r\n  });\r\n\r\n  form.appendChild(comments);\r\n\r\n  // add Save and Delete icons\r\n  const save = document.createElement('button');\r\n  save.classList.add('mdc-fab', 'mdc-fab--mini', 'rew-fab--save');\r\n  const span = document.createElement('span');\r\n  span.innerText = 'save';\r\n  span.classList.add('mdc-fab__icon', 'material-icons');\r\n  save.type = 'submit';\r\n  save.appendChild(span);\r\n  form.appendChild(save);\r\n\r\n  const delete_btn = document.createElement('button');\r\n  delete_btn.classList.add('mdc-fab', 'mdc-fab--mini', 'rew-fab--delete');\r\n  const span_delete = document.createElement('span');\r\n  span_delete.innerText = 'delete';\r\n  span_delete.classList.add('mdc-fab__icon', 'material-icons');\r\n  delete_btn.appendChild(span_delete);\r\n  form.appendChild(delete_btn);\r\n\r\n  li.appendChild(form);\r\n  ul.insertBefore(li, ul.firstChild);\r\n  delete_btn.focus();\r\n  name.focus();\r\n\r\n  // disable create and favorite buttons\r\n  const add_fab = document.getElementById('add-fab');\r\n  add_fab.classList.add('app-fab--hide');\r\n  const favorite_fab = document.getElementsByClassName('app-fab--favorite')[0];\r\n  favorite_fab.classList.add('app-fab--hide');\r\n\r\n  delete_btn.addEventListener('click', (event) => {\r\n    event.preventDefault();\r\n    if ((name.value != '') | (comments.value != '')) {\r\n      let delConfirm = document.getElementById('delConfirm');\r\n      let cancelButton = document.getElementById('delConfirm-cancel');\r\n      let confirmButton = document.getElementById('delConfirm-confirm');\r\n\r\n      delConfirm.showModal();\r\n\r\n      // Cancel button closes the dialog box and return\r\n      cancelButton.addEventListener('click', () => {\r\n        delConfirm.close();\r\n        return;\r\n      });\r\n      // Confirm button closes the dialog box and the review\r\n      confirmButton.addEventListener('click', () => {\r\n        delConfirm.close();\r\n        closeReview();\r\n      });\r\n    } else {\r\n      closeReview();\r\n    }\r\n  });\r\n\r\n  function closeReview() {\r\n    void 0;\r\n    add_fab.classList.remove('app-fab--hide');\r\n    favorite_fab.classList.remove('app-fab--hide');\r\n    li.remove();\r\n  }\r\n\r\n  form.addEventListener('submit', (event) => {\r\n    event.preventDefault();\r\n    sendData();\r\n  });\r\n\r\n  function sendData() {\r\n    // Bind the FormData object and the form element\r\n    let FD = new FormData(form);\r\n    // Define what happens on successful data submission\r\n    if (navigator.onLine) {\r\n      let XHR = new XMLHttpRequest();\r\n      XHR.addEventListener('load', function (event) {\r\n        toast('The review is submitted', 5000);\r\n        closeReview();\r\n        DBHelper.fetchReviewsFromNetwork(getParameterByName('id'), (error, reviews) => {\r\n          void 0;\r\n          fillReviewsHTML(reviews, false, true);\r\n        }, true);\r\n      });\r\n      // Define what happens in case of error\r\n      XHR.addEventListener('error', function (event) {\r\n        toast('Oops! Something went wrong.', 5000);\r\n      });\r\n      // Set up our request\r\n      XHR.open('POST', `${DBHelper.DATABASE_REVIEWS_URL}/`);\r\n\r\n      // The data sent is what the user provided in the form\r\n      XHR.send(FD);\r\n    } else {\r\n      let review = {\r\n        restaurant_id: FD.get('restaurant_id'),\r\n        name: FD.get('name'),\r\n        rating: FD.get('rating'),\r\n        comments: FD.get('comments')\r\n      };\r\n      DBHelper.addReviewToOfflineDB(review).then(() => {\r\n        toast('The review is saved. Will be submitted when you return online', 7000);\r\n        closeReview();\r\n        let reviews = [review];\r\n        fillReviewsHTML(reviews, true, true);\r\n      });\r\n    }\r\n  }\r\n}","/**\r\n * Common database helper functions.\r\n */\r\nclass DBHelper {\r\n\r\n  set dbPromise(value) {\r\n    this._dbPromise = value;\r\n  }\r\n\r\n  get dbPromise() {\r\n    return this._dbPromise;\r\n  }\r\n\r\n  set dbOpened(value) {\r\n    this._dbOpened = value;\r\n  }\r\n\r\n  get dbOpened() {\r\n    return this._dbOpened;\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Database URL.\r\n   * Change this to restaurants.json file location on your server.\r\n   */\r\n  static get DATABASE_URL() {\r\n    const port = 1337; // Change this to your server port\r\n    return `http://localhost:${port}/restaurants`;\r\n  }\r\n\r\n  static get DATABASE_REVIEWS_URL() {\r\n    const port = 1337; // Change this to your server port\r\n    return `http://localhost:${port}/reviews`;\r\n  }\r\n\r\n  /**\r\n   * Fetch all restaurants.\r\n   */\r\n  static fetchRestaurants(callback) {\r\n\r\n    // open DB and set dbPromise\r\n    DBHelper.openDB().then(function (db) {\r\n      if (db) {\r\n        DBHelper.dbPromise = db;\r\n        void 0;\r\n        // Read restaurants from DB;\r\n        DBHelper.getRestaurantsFromDB().then(restaurants => {\r\n          if (restaurants.length) {\r\n            callback(null, restaurants);\r\n          } else {\r\n            void 0;\r\n            DBHelper.fetchRestaurantsFromNetwork(callback);\r\n          }\r\n        });\r\n      } else {\r\n        void 0;\r\n        DBHelper.fetchRestaurantsFromNetwork(callback);\r\n      }\r\n    }).then(function () {}).catch(function () {\r\n      void 0;\r\n      DBHelper.fetchRestaurantsFromNetwork(callback);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all restaurants from network.\r\n   */\r\n  static fetchRestaurantsFromNetwork(callback, saveToDB = true) {\r\n    let xhr = new XMLHttpRequest();\r\n    xhr.open('GET', DBHelper.DATABASE_URL);\r\n    xhr.onload = () => {\r\n      if (xhr.status === 200) { // Got a success response from server!\r\n        const restaurants = JSON.parse(xhr.responseText);\r\n        void 0;\r\n        callback(null, restaurants);\r\n        // write restaurants to db\r\n        if (saveToDB) {\r\n          DBHelper.saveRestaurantsToDB(restaurants);\r\n        }\r\n      } else { // Oops!. Got an error from server.\r\n        const error = (`Request failed. Returned status of ${xhr.status}`);\r\n        callback(error, null);\r\n      }\r\n    };\r\n    xhr.send();\r\n  }\r\n\r\n\r\n  /**\r\n   * Fetch a restaurant by its ID.\r\n   */\r\n  static fetchRestaurantById(id, callback) {\r\n    // fetch all restaurants with proper error handling.\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        const restaurant = restaurants.find(r => r.id == id);\r\n        if (restaurant) { // Got the restaurant\r\n          callback(null, restaurant);\r\n        } else { // Restaurant does not exist in the database\r\n          callback('Restaurant does not exist', null);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine type with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisine(cuisine, callback) {\r\n    // Fetch all restaurants  with proper error handling\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given cuisine type\r\n        const results = restaurants.filter(r => r.cuisine_type == cuisine);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByNeighborhood(neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Filter restaurants to have only given neighborhood\r\n        const results = restaurants.filter(r => r.neighborhood == neighborhood);\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\r\n   */\r\n  static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        let results = restaurants;\r\n        if (cuisine != 'all') { // filter by cuisine\r\n          results = results.filter(r => r.cuisine_type == cuisine);\r\n        }\r\n        if (neighborhood != 'all') { // filter by neighborhood\r\n          results = results.filter(r => r.neighborhood == neighborhood);\r\n        }\r\n        callback(null, results);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all neighborhoods with proper error handling.\r\n   */\r\n  static fetchNeighborhoods(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all neighborhoods from all restaurants\r\n        const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood);\r\n        // Remove duplicates from neighborhoods\r\n        const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i);\r\n        callback(null, uniqueNeighborhoods);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all cuisines with proper error handling.\r\n   */\r\n  static fetchCuisines(callback) {\r\n    // Fetch all restaurants\r\n    DBHelper.fetchRestaurants((error, restaurants) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        // Get all cuisines from all restaurants\r\n        const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type);\r\n        // Remove duplicates from cuisines\r\n        const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i);\r\n        callback(null, uniqueCuisines);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Restaurant page URL.\r\n   */\r\n  static urlForRestaurant(restaurant) {\r\n    return (`./restaurant.html?id=${restaurant.id}`);\r\n  }\r\n\r\n  /**\r\n   * Restaurant image URL.\r\n   */\r\n  static imageUrlForRestaurant(restaurant) {\r\n    // use id instead photograph to avoid an error with Casa Enrique (a bug?)\r\n    return (`/img/${restaurant.id}`);\r\n  }\r\n\r\n  /**\r\n   * Restaurant image description.\r\n   */\r\n  static imageDescriptionForRestaurant(restaurant) {\r\n    // Please note that I used Google Translate. Translations can be a little fun... \r\n    const altImg = [\r\n      'Inside view of the Mission Chinese Food restaurant. Many people talk to each other',\r\n      'A pizza cut into six slices',\r\n      'Inside view of Kang Ho Dong Baekjeong restaurant. You can see various modern style tables and chairs',\r\n      'Panoramic photo of the entrance. You can see the two streets on which the restaurant overlooks',\r\n      'Inside view of the Roberto\\'s Pizza. In the background, see the kitchen and some pizza makers',\r\n      'Inside view of the Hometown BBQ restaurant. On the wall a huge US flag',\r\n      'Two people walking around the restaurand. You can see some customers inside',\r\n      'Detail of the The Dutch banner',\r\n      'Inside view of the Mu Ramen restaurant. Some customers eat using the typical oriental chopsticks',\r\n      'Inside view of restaurant. You see the counter with the window and several bottles.'\r\n    ];\r\n    return (altImg[restaurant.id - 1]);\r\n  }\r\n\r\n\r\n  /**\r\n   * Map marker for a restaurant.\r\n   */\r\n  static mapMarkerForRestaurant(restaurant, map) {\r\n    const marker = new google.maps.Marker({\r\n      position: restaurant.latlng,\r\n      title: restaurant.name,\r\n      url: DBHelper.urlForRestaurant(restaurant),\r\n      map: map,\r\n      animation: google.maps.Animation.DROP\r\n    });\r\n    return marker;\r\n  }\r\n\r\n  static openDB() {\r\n    //check for support\r\n    DBHelper.dbOpened = true;\r\n    if (!('indexedDB' in window)) {\r\n      void 0;\r\n      return Promise.resolve();\r\n    }\r\n\r\n    return idb.open('restaurants-reviews', 4, upgradeDb => {\r\n      switch (upgradeDb.oldVersion) {\r\n        case 0:\r\n          upgradeDb.createObjectStore('restaurants', {\r\n            keyPath: 'id'\r\n          });\r\n        case 1:\r\n          upgradeDb.createObjectStore('reviews', {\r\n            keyPath: 'id'\r\n          });\r\n          var reviewsStore = upgradeDb.transaction.objectStore('reviews');\r\n          reviewsStore.createIndex('restaurant', 'restaurant_id');\r\n        case 2:\r\n          upgradeDb.createObjectStore('offline-reviews', {\r\n            keyPath: 'id',\r\n            autoIncrement: true\r\n          });\r\n        case 3:\r\n          upgradeDb.createObjectStore('offline-favorites', {\r\n            keyPath: 'id',\r\n            autoIncrement: true\r\n          });\r\n      }\r\n    });\r\n\r\n  }\r\n\r\n  /**\r\n   * Delete a restaurants from local DB\r\n   */\r\n  static deleteRestaurantsFromDB(db = DBHelper.db) {\r\n    if (!db) return;\r\n    const tx = db.transaction('restaurants', 'readwrite');\r\n    const restaurantsStore = tx.objectStore('restaurants');\r\n    restaurantsStore.clear();\r\n    void 0;\r\n    return tx.complete;\r\n  }\r\n\r\n  /**\r\n   * Save the restaurant in the local DB\r\n   */\r\n  static addRestaurantToDB(db, data) {\r\n    if (!db) return;\r\n    void 0;\r\n    const tx = db.transaction('restaurants', 'readwrite');\r\n    const restaurantsStore = tx.objectStore('restaurants');\r\n    restaurantsStore.put(data);\r\n    void 0;\r\n    return tx.complete;\r\n  }\r\n\r\n  /**\r\n   * Get all restaurants from local DB\r\n   */\r\n  static getRestaurantsFromDB() {\r\n    if (!DBHelper.dbPromise) return;\r\n    const tx = DBHelper.dbPromise.transaction('restaurants', 'readonly');\r\n    const restaurantsStore = tx.objectStore('restaurants');\r\n    return restaurantsStore.getAll();\r\n  }\r\n\r\n\r\n  /*\r\n   * Save data to local database\r\n   */\r\n  static saveRestaurantsToDB(data) {\r\n    if (!(DBHelper.dbOpened)) {\r\n      return;\r\n    }\r\n    if (navigator.onLine == true) {\r\n      DBHelper.deleteRestaurantsFromDB();\r\n      let tx = DBHelper.dbPromise.transaction('restaurants', 'readwrite');\r\n      let restaurantsStore = tx.objectStore('restaurants');\r\n      data.forEach(function (restaurant) {\r\n        restaurantsStore.put(restaurant);\r\n      });\r\n      void 0;\r\n      return tx.complete;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Update favorite to local database\r\n   */\r\n  static updateRestaurantLocalDB(restaurant) {\r\n    if (!(DBHelper.dbOpened)) {\r\n      return;\r\n    }\r\n    let tx = DBHelper.dbPromise.transaction('restaurants', 'readwrite');\r\n    let restaurantsStore = tx.objectStore('restaurants');\r\n    restaurantsStore.put(restaurant);\r\n    return tx.complete;\r\n  }\r\n\r\n  /*\r\n   * add review to offline db (will be synch when online)\r\n   */\r\n  static addReviewToOfflineDB(review) {\r\n    if (!(DBHelper.dbOpened)) {\r\n      return;\r\n    }\r\n    let tx = DBHelper.dbPromise.transaction('offline-reviews', 'readwrite');\r\n    let offlineStore = tx.objectStore('offline-reviews');\r\n    offlineStore.put(review);\r\n    return tx.complete;\r\n  }\r\n\r\n  /**\r\n   * Get all offline reviews from local DB\r\n   */\r\n  static getReviewsOffline() {\r\n    if (!DBHelper.dbPromise) return;\r\n    const tx = DBHelper.dbPromise.transaction('offline-reviews', 'readonly');\r\n    const offlineStore = tx.objectStore('offline-reviews');\r\n    return offlineStore.getAll();\r\n  }\r\n\r\n  /**\r\n   * Delete review from offline-reviews db.\r\n   */\r\n  static deleteReviewFromOffline(review) {\r\n    const tx = DBHelper.dbPromise.transaction('offline-reviews', 'readwrite');\r\n    const offlineStore = tx.objectStore('offline-reviews');\r\n    return offlineStore.delete(review.id);\r\n  }\r\n\r\n  /*\r\n   * add favorite to offline db (will be synch when online)\r\n   */\r\n  static addFavoriteToOfflineDB(favorite) {\r\n    if (!(DBHelper.dbOpened)) {\r\n      return;\r\n    }\r\n    let tx = DBHelper.dbPromise.transaction('offline-favorites', 'readwrite');\r\n    let offlineStore = tx.objectStore('offline-favorites');\r\n    offlineStore.put(favorite);\r\n    return tx.complete;\r\n  }\r\n\r\n\r\n  /**\r\n   * Get favorites from offline-favorites db.\r\n   */\r\n  static getFavoritesOffline() {\r\n    if (!DBHelper.dbPromise) return;\r\n    const tx = DBHelper.dbPromise.transaction('offline-favorites', 'readonly');\r\n    const offlineStore = tx.objectStore('offline-favorites');\r\n    return offlineStore.getAll();\r\n  }\r\n\r\n  /**\r\n   * Delete favorites from offline-favorites db.\r\n   */\r\n  static deleteFavoriteFromOffline(favorite) {\r\n    const tx = DBHelper.dbPromise.transaction('offline-favorites', 'readwrite');\r\n    const offlineStore = tx.objectStore('offline-favorites');\r\n    return offlineStore.delete(favorite.id);\r\n  }\r\n\r\n  /**\r\n   * Update the favorite status of the restaurant\r\n   */\r\n  static updateFavorite(favorite) {\r\n    return fetch(`${DBHelper.DATABASE_URL}/${favorite.id}/?is_favorite=${favorite.value}`, {\r\n      method: 'PUT',\r\n    }).then(function () {\r\n      void 0;\r\n      DBHelper.fetchRestaurantsFromNetwork((error, restaurants) => {\r\n        if (error) {\r\n          void 0;\r\n        }\r\n      }, true)\r\n    }).catch(function (error) {\r\n      void 0;\r\n      DBHelper.addFavoriteToOfflineDB(favorite);\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * Send all offline favorites to the server\r\n   */\r\n  static sendOfflineFavoritesToServer(callback) {\r\n    // read all offline favorites\r\n    return DBHelper.getFavoritesOffline().then(favorites => {\r\n      // send favorites to the server\r\n      favorites.forEach(favorite => {\r\n        return DBHelper.updateFavorite(favorite).then(function () {\r\n          toast('Favorites offline submitted', 5000);\r\n          DBHelper.deleteFavoriteFromOffline(favorite);\r\n        }).catch(function (error) {\r\n          void 0;\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send all offline reviews to the server\r\n   */\r\n  static sendOfflineReviewsToServer() {\r\n    // read all offline reviews\r\n    return DBHelper.getReviewsOffline().then(reviews => {\r\n      // send reviews to the server\r\n      reviews.forEach(review => {\r\n        var FD = new FormData();\r\n        // setting form data\r\n        FD.append('restaurant_id', review.restaurant_id);\r\n        FD.append('name', review.name);\r\n        FD.append('rating', review.rating);\r\n        FD.append('comments', review.comments);\r\n        return fetch(`${DBHelper.DATABASE_REVIEWS_URL}/`, {\r\n          method: 'POST',\r\n          body: FD\r\n        }).then(function () {\r\n          void 0;\r\n          toast('Review offline submitted', 5000);\r\n          DBHelper.deleteReviewFromOffline(review);\r\n          return DBHelper.fetchReviewsFromNetwork(review.restaurant_id, (error, reviews) => {\r\n            void 0;\r\n            let pageURL = window.location.href;\r\n            if (pageURL.includes('/restaurant.html?id=')) {\r\n              fillReviewsHTML(reviews, false, true);\r\n            }\r\n          }, true);\r\n        }).catch(function (error) {\r\n          toast('Sending review offline.... Oops! Something went wrong.', 5000);\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * Sync all changes to the restaurants \r\n   */\r\n  static syncFavorites() {\r\n    DBHelper.sendOfflineFavoritesToServer((error, favorites) => {\r\n      if (error) {\r\n        void 0;\r\n        return error;\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * Sync all changes to the reviews\r\n   */\r\n  static syncReviews(callback) {\r\n    // send ALL offline reviews (this one and the others restaurants)\r\n    return DBHelper.sendOfflineReviewsToServer().then(() => {\r\n      return callback(null)\r\n    }).catch((error) => {\r\n      void 0;\r\n      return callback(error, null);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Sync all changes\r\n   */\r\n  static syncAll() {\r\n    if (navigator.onLine == true) {\r\n      setTimeout(() => {\r\n        DBHelper.syncFavorites();\r\n        DBHelper.syncReviews((error) => {\r\n          if (error) {\r\n            void 0;\r\n            return error;\r\n          }\r\n        });\r\n      }, 2000);\r\n    }\r\n  }\r\n\r\n  /*\r\n   * Set favorite status\r\n   */\r\n  static setFavoriteStatus(restaurant) {\r\n    if (restaurant.is_favorite) {\r\n      const favorite = document.getElementById(restaurant.id);\r\n      if ((restaurant.is_favorite == true) || (restaurant.is_favorite == 'true')) {\r\n        favorite.classList.add('restaurant-name_isfavorite');\r\n      } else {\r\n        favorite.classList.remove('restaurant-name_isfavorite');\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Fetch all reviews.\r\n   * @restaurant_id : if specified fetch only the reviews of this restaurants\r\n   */\r\n  static fetchReviews(restaurant_id, callback) {\r\n\r\n    // open DB and set dbPromise\r\n    DBHelper.openDB().then(function (db) {\r\n      if (db) {\r\n        DBHelper.dbPromise = db;\r\n        void 0;\r\n        // Read reviews from DB;\r\n        DBHelper.getReviewsFromDB(restaurant_id).then(reviews => {\r\n          if (reviews.length) {\r\n            return callback(null, reviews);\r\n          } else {\r\n            void 0;\r\n            DBHelper.fetchReviewsFromNetwork(restaurant_id, callback);\r\n          }\r\n        });\r\n      } else {\r\n        void 0;\r\n        DBHelper.fetchReviewsFromNetwork(restaurant_id, callback);\r\n      }\r\n    }).then(function () {}).catch(function () {\r\n      void 0;\r\n      DBHelper.fetchReviewsFromNetwork(restaurant_id, callback);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch a review by its ID.\r\n   */\r\n  static fetchReviewById(id, callback) {\r\n    // fetch all reviews with proper error handling.\r\n    DBHelper.fetchReviews(null, (error, reviews) => {\r\n      if (error) {\r\n        callback(error, null);\r\n      } else {\r\n        const review = reviews.find(r => r.id == id);\r\n        if (review) { // Got the review\r\n          callback(null, review);\r\n        } else { // review does not exist in the database\r\n          callback('Review does not exist', null);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fetch all reviews of the restaurant from network.\r\n   */\r\n  static fetchReviewsFromNetwork(restaurant_id, callback, saveToDB = true) {\r\n    // Restaurant Reviews\r\n    // Offline USE\r\n    // The client application works offline.\r\n    // JSON responses are cached using the IndexedDB API.\r\n    // Any data PREVIOUSLY accessed while connected is reachable while offline.\r\n\r\n    return fetch(`${DBHelper.DATABASE_REVIEWS_URL}/?restaurant_id=${restaurant_id}`, {\r\n      method: 'GET'\r\n    }).then(function (response) {\r\n      return response.json();\r\n    }).then(function (json) {\r\n      let reviews = json;\r\n      void 0;\r\n      // write reviews to db\r\n      if (saveToDB) {\r\n        return DBHelper.saveReviewsToDB(restaurant_id, reviews).then(() => {\r\n          return callback(null, reviews);\r\n        });\r\n      } else {\r\n        return callback(null, reviews);\r\n      }\r\n    }).catch(function (error) {\r\n      return callback(error, null);\r\n    });\r\n  }\r\n\r\n\r\n\r\n  /*\r\n   * Save reviews to local database\r\n   */\r\n  static saveReviewsToDB(restaurant_id, data) {\r\n    if (!(DBHelper.dbOpened)) {\r\n      return;\r\n    }\r\n    // delete all reviews of this restaurants\r\n    if (navigator.onLine == true) {\r\n      return DBHelper.deleteReviewsFromDB(restaurant_id).then(() => {\r\n        let tx = DBHelper.dbPromise.transaction('reviews', 'readwrite');\r\n        let reviewsStore = tx.objectStore('reviews');\r\n        void 0;\r\n        data.forEach(function (review) {\r\n          review.restaurant_id = parseInt(review.restaurant_id);\r\n          reviewsStore.put(review);\r\n          void 0;\r\n        });\r\n        return tx.complete;\r\n      });\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * delete all reviews of the restaurant in the local DB\r\n   *\r\n   */\r\n  static deleteReviewsFromDB(restaurant_id) {\r\n    if (!DBHelper.dbPromise) return;\r\n    return DBHelper.getReviewsFromDB(restaurant_id).then(reviews => {\r\n      const tx = DBHelper.dbPromise.transaction('reviews', 'readwrite');\r\n      const reviewsStore = tx.objectStore('reviews');\r\n      reviews.forEach(review => {\r\n        reviewsStore.delete(review.id);\r\n      });\r\n      return tx.complete;\r\n    });\r\n  }\r\n\r\n\r\n  /**\r\n   * get all reviews.\r\n   * @restaurant_id : if specified get only the reviews of this restaurants\r\n   */\r\n  static getReviewsFromDB(restaurant_id) {\r\n    if (!DBHelper.dbPromise) return;\r\n    const tx = DBHelper.dbPromise.transaction('reviews', 'readonly');\r\n    const reviewsStore = tx.objectStore('reviews');\r\n    if (!restaurant_id) {\r\n      return reviewsStore.getAll();\r\n    } else {\r\n      let index = reviewsStore.index('restaurant');\r\n      return index.getAll(Number(restaurant_id));\r\n    }\r\n  }\r\n}"]}